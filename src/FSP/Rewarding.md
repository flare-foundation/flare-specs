# Rewarding


## 1. Overview

To incentivise participation in FSP a reward mechanism exists that distributes funds to infrastructure providers and their delegators based performance in each sub-protocol.

The current sub-protocols are:
1) Flare Time Series Oracle (FTSO) - reference feeds
2) FTSO - fast updates
3) Flare Data Connector (FDC)

Rewards are distributed every 3.5 days, which constitutes a **reward epoch**. A combined reward amount is issued to a beneficiary for all sub-protocols for the whole reward epoch. 

Rewards are issued as **claims**, which need to submitted to [`RewardManager`](https://gitlab.com/flarenetwork/flare-smart-contracts-v2/-/blob/main/contracts/protocol/implementation/RewardManager.sol?ref_type=heads) smart contract to receive funds.

A complete list of claims is calculated after the reward epoch ends, and a **reward hash** is generated by using a Merkle Tree. Once the hash is signed by weight-based majority of the participants, reward claiming becomes available on `RewardManager`.


### 1.1 Reward Epoch

- Participants register for every epoch, only registered can participate in protocols
- Every reward epoch initializes a signing policy on start with participants and their weights. Only those participants (and their delegators) will be rewarded, and reward amounts will be based on relative weights.

TODO: Define how weight is calculated?

### 1.2. Voting Rounds

FTSO and FDC protocols operate in 90second voting rounds, which are used to submit and reach consensus on protocol data outputs for that round.

Rewards are also calculated for every round, and later aggregated for all rounds in the reward epoch (3360) TODO.

### 1.3. Incentives and penalties

Correct voting round participation results in accruing rewards, malicious behaviour is disincentivised by applying reward **penalties**. Penalties are negative reward amounts per round, which accumulate and may potentially result in total negative reward amount for an entity for the full reward epoch. In that case, the entity receives no rewards.

### 1.4 Minimal conditions

For FSP security, infrastructure providers are expected to participate in _all_ subprotocols, as well as staking - operate a Flare validator node. Thus, to be rewarded for an epoch, providers have to meet **minimal conditions** for protocol participation. For example, in FTSO scaling TODO

Once reward claims are calculated for an epoch, provider submissions are analysed, and if participation thresholds are not met, the claims for the provider and their delegators might get burnt.



---


---

## WNatDelegationFee

## Minimal conditions

An entity is eligible for the rewards only if they fulfill all the minimal conditions.

## Reward claims

Each reward claim contains:

- rewardEpochId - reward epoch ID for the reward.
- beneficiary - the address of the reward beneficiary or node id (20-bytes)
- amount - amount of the reward in FLR
- claimType - the type of reward claim.
  It can be one of:

  - **direct** - The beneficiary is any address.
    The reward is solely owed to the beneficiary.
    This type of claims is used for back claims of undistributed rewards for providers of funds into rewarding pools, burn claims, or other direct rewarding approaches needed in sub protocols.
  - **fee** - Beneficiaries is the identity address an eligible entity for the reward epoch only (his address is provided).
    The fees include WFLR delegation fees and node staking fees.
    The reward is solely owed to the beneficiary.
  - **wflr** - The beneficiary is the delegation address of an eligible eligible for the given reward epoch.
    The amount includes the value is to be distributed to the delegators according their share in $W_D(beneficiary)$.
  - **mirror** - The beneficiary is a node ID of an eligible entity for the given reward epoch.
    The amount includes the value that is to be distributed to the stakers according their share in the amount staked to node ID.

## Distribution

Let $R$ be the rewards accrued by the entity $p$.
Let $W_P(p)$, $W_D(p)$, and $W'_D(p)$ be defined as in the calculation of
